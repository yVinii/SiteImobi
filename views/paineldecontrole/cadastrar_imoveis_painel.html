<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!----======== CSS ======== -->
    <link rel="stylesheet" href="../../css/css_painel/style.css">
    <!----===== Boxicons CSS ===== -->
    <link href='https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css' rel='stylesheet'>

    <!----===== JQuery ===== -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" charset="UTF-8"> </script>
    <title>Painel de Controle</title>
</head>
<body>
    <nav class="sidebar close">
        <header>
            <div class="image-text">
                <span class="image">
                    <img src="../../img/imagens/035e6056-6275-4560-a32f-ada5a2c6d099-removebg-preview.png" alt="">
                </span>
                <div class="text logo-text">
                    <span class="name">LSilva</span>
                    <span class="profession">Negócios Imobiliários</span>
                </div>
            </div>
            <i class='bx bx-chevron-right toggle'></i>
        </header>
        <div class="menu-bar">
            <div class="menu">
                <li class="search-box">
                    <i class='bx bx-search icon'></i>
                    <input type="text" placeholder="Pesquisar...">
                </li>
                <ul class="menu-links">
                    <li class="nav-link">
                        <a href="index.html">
                            <i class='bx bx-home-alt icon' ></i>
                            <span class="text nav-text">Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-link">
                        <a href="imoveis_painrl.html">
                            <i class='bx bx-building-house icon'></i>
                            <span class="text nav-text">Imóveis</span>
                        </a>
                    </li>
                    <li class="nav-link">
                        <a href="corretores.html">
                            <i class='bx bx-group icon' ></i>
                            <span class="text nav-text">Corretores</span>
                        </a>
                    </li>
                    <li class="nav-link">
                        <a href="index.html">
                            <i class='bx bx-bell icon'></i>
                            <span class="text nav-text">Notificações</span>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="bottom-content">
                <li class="">
                    <a href="../home.html">
                        <i class='bx bx-log-out icon' ></i>
                        <span class="text nav-text">Sair</span>
                    </a>
                </li>
                <li class="mode">
                    <div class="sun-moon">
                        <i class='bx bx-moon icon moon'></i>
                        <i class='bx bx-sun icon sun'></i>
                    </div>
                    <span class="mode-text text">Modo Escuro</span>
                    <div class="toggle-switch">
                        <span class="switch"></span>
                    </div>
                </li>
                
            </div>
        </div>
    </nav>
    
    <section>
            <div class="container">
                <div class="form">
                    <form action="" id="form-data">
                        <div class="form-header">
                            <div class="title">
                                <h1>Cadastrar Imóvel</h1>
                            </div>
                        </div>

                        <div class="input-group">
                            <div class="input-box">
                                <label for="titulo">Título</label>
                                <input type="text" id="title" name="title" placeholder="Digite o título" required>
                            </div>

                            <div class="input-box">
                                <label for="firstname">Nome do Proprietário</label>
                                <input type="text" id="owner" name="owner" placeholder="Digite o nome do proprietário" required>
                            </div>

                            <div class="input-box">
                                <label for="ownerPhone">Telefone Proprietário</label>
                                <input type="phone" id="ownerPhone" name="ownerPhone" placeholder="Digite o Telefone do Proprietário" required>
                            </div>

                            <div class="input-box">
                                <label for="corretorl">Corretor</label>
                                <select name="broker" id="broker">
                                    <option>Selecione</option>
                                </select>
                            </div>

                            <div class="input-box">
                                <label for="city">Cidade</label>
                                <select name="city" id="cidade">
                                    <option>Selecione</option>
                                </select>
                            </div>

                            <div class="input-box">
                                <label for="bairro">Bairro</label>
                                <input type="text" id="neighborhood" name="neighborhood" placeholder="Digite o bairro" required>
                            </div>

                            <div class="input-box">
                                <label for="endereço">Endereço</label>
                                <input type="text" id="address" name="address" placeholder="Digite o endereço" required>
                            </div>

                             <!--Select tipo de imóvel-->
                            <div class="input-box">
                                <label for="tipoimovel">Tipo de imóvel</label>
                                <select name="propertyType" id="propertytype">
                                    <option>Selecione</option>
                                </select>
                            </div>

                            <!--Select tipo de negociação-->
                            <div class="input-box">
                                <label for="tipoimovel">Tipo de negociação</label>
                                <select name="tipoimovel" id="tipo-negociacao">
                                    <option>Selecione</option>
                                    <option value="Venda">Venda</option>
                                    <option value="Locação">Locação</option>
                                    <option value="Ambos">Ambos</option>
                                </select>
                            </div>

                            <div class="input-box">
                                <label for="areaM">Área em m²</label>
                                <input type="text" id="groundm2" name="groundm2" placeholder="Digite a área em m²" required>
                            </div>

                            <div class="input-box">
                                <label for="areaConstruida">Área Construída</label>
                                <input type="text" id="buildm2" name="buildm2" placeholder="Digite a área construída" required>
                            </div>

                            <div class="input-box">
                                <label for="quartos">Quartos</label>
                                <input type="number" id="nbedrooms" name="nbedrooms" placeholder="Número de quartos" required>
                            </div>

                            <div class="input-box">
                                <label for="banheiros">Banheiros</label>
                                <input type="number" id="nbathrooms" name="nbathrooms" placeholder="Número de banheiros" required>
                            </div>

                            <div class="input-box">
                                <label for="nsuites">Suítes</label>
                                <input type="number" id="nsuites" name="nsuites" placeholder="Digite o número de suítes" required>
                            </div>

                            <div class="input-box">
                                <label for="garagem">Vagas de Garagem</label>
                                <input type="number" id="nvacancies" name="nvacancies" placeholder="Número de vagas" required>
                            </div>

                            <div class="input-box">
                                <label for="registro">Registro</label>
                                <input type="number" id="register" name="register" placeholder="Número de Registro" required>
                            </div>

                            <div class="input-box">
                                <label for="valorPropriedade">Valor Propriedade</label>
                                <input type="text" id="value" name="value" placeholder="R$ 00.000.000,00" required>
                            </div>

                            <div class="input-box info-add">
                                <label for="infoadd">Dados do imóvel</label>
                                <textarea id="description" name="description" placeholder="Digite as informações" required rows="3"></textarea>
                            </div>
                        </div>

                        <!-- Uploud -->

                        <div class='wrapper'>
                            <div class="upload">
                                <div class="upload-wrapper">
                                    <div class="upload-img">
                                        <!-- image here -->
                                    </div>
                                    <div class="upload-info">
                                        <p>
                                            <span class="upload-info-value">0</span> arquivos(s) selecionados.
                                        </p>
                                    </div>
                                    <div class="upload-area">
                                        <div class="upload-area-img">
                                            <img src="../../img/upload.png" alt="">
                                        </div>
                                        <p class="upload-area-text">Selecionar imagens ou <span>procurar</span>.</p>
                                    </div>
                                    <input type="file" class="visually-hidden" id="upload-input" multiple>
                                </div>
                            </div>
                        </div>
                        <div class="envie-button">
                            <button type="submit">Enviar</button>
                        </div>
                    </form>
                </div>
            </div>
    </section>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
                document.getElementById('form-data').addEventListener('submit', function (event) {
                    event.preventDefault();
                    enviarDados();
                });
            carregarCorretores();
            carregarCidades();
            carregarTipoPropriedade();
        });

            async function carregarCidades() {
                try {
                    const response = await fetch('http://localhost:5502/city/');
                    const data = await response.json();

                    if (response.ok) {
                        const cidades = data.cities;
                        const selectElement = document.getElementById('cidade');

                        selectElement.innerHTML = '';

                        const defaultOption = document.createElement('option');
                        defaultOption.value = '';
                        defaultOption.text = 'Selecione';
                        selectElement.appendChild(defaultOption);


                        cidades.forEach((city) => {
                            const option = document.createElement('option');
                            option.text = city.name;
                            option.value = city.id;
                            selectElement.appendChild(option);
                        });

                        console.log('Cidades carregadas com sucesso!');
                    } else {
                        console.log('Erro ao obter cidades:', response.statusText);
                    }
                } catch (error) {
                    console.log('Erro na requisição:', error);
                }
            }


            async function carregarTipoPropriedade() {
                try {
                    const response = await fetch('http://localhost:5502/propertytype/');
                    const data = await response.json();

                    if (response.ok) {
                        const tipo = data.propertyTypes;
                        const selectElement = document.getElementById('propertytype');

                        selectElement.innerHTML = '';

                        const defaultOption = document.createElement('option');
                        defaultOption.value = '';
                        defaultOption.text = 'Selecione';
                        selectElement.appendChild(defaultOption);


                        tipo.forEach((propertytype) => {
                            const option = document.createElement('option');
                            option.text = propertytype.name;
                            option.value = propertytype.id;
                            selectElement.appendChild(option);
                        });

                        console.log('Tipo carregados com sucesso!');
                    } else {
                        console.log('Erro ao obter tipo:', response.statusText);
                    }
                } catch (error) {
                    console.log('Erro na requisição:', error);
                }
            }




            async function carregarCorretores() {
                try {
                    const response = await fetch('http://localhost:5502/broker/');
                    const data = await response.json();

                    if (response.ok) {
                        const brokers = data.brokers;
                        const selectElement = document.getElementById('broker');

                        selectElement.innerHTML = '';

                        const defaultOption = document.createElement('option');
                        defaultOption.value = '';
                        defaultOption.text = 'Selecione';
                        selectElement.appendChild(defaultOption);


                        brokers.forEach((broker) => {
                            const option = document.createElement('option');
                            option.value = broker.id;
                            option.text = broker.name;
                            selectElement.appendChild(option);
                        });

                        console.log('Corretores carregados com sucesso!');
                    } else {
                        console.error('Erro ao obter corretores:', response.statusText);
                    }
                } catch (error) {
                    console.error('Erro na requisição:', error);
                }
            }

        
            async function enviarDados() {
                try {
                    const title = document.getElementById('title').value;
                    const address = document.getElementById('address').value;
                    const value = document.getElementById('value').value;
                    const tipoimovel = document.getElementById('propertytype').value;
                    const bairro = document.getElementById('neighborhood').value;
                    const banheiros = document.getElementById('nbathrooms').value;
                    const vagas = document.getElementById('nvacancies').value;
                    const registro = document.getElementById('register').value;
                    const suites = document.getElementById('nsuites').value;
                    const area = document.getElementById('groundm2').value;
                    const construido = document.getElementById('buildm2').value;
                    const quartos = document.getElementById('nbedrooms').value;
                    const city = document.getElementById('cidade').value;
                    const corretor = document.getElementById('broker').value;
                    const tipoNegociacao = document.getElementById('tipo-negociacao').value;
                    const owner = document.getElementById('owner').value;
                    const ownerPhone = document.getElementById('ownerPhone').value;
                    const infoadd = document.getElementById('description').value;
                    const files = document.getElementById('upload-input').files;

                    const formData = new FormData();
                    formData.append('title', title);
                    formData.append('address', address);
                    formData.append('value', value);
                    formData.append('propertyTypeId', tipoimovel);
                    formData.append('cityId', city);
                    formData.append('typeofsale', tipoNegociacao);
                    formData.append('description', infoadd);
                    formData.append('brokerId', corretor);
                    formData.append('neighborhood', bairro);
                    formData.append('nbedrooms', quartos);
                    formData.append('buildm2', construido);
                    formData.append('groundm2', area);
                    formData.append('nsuites', suites);
                    formData.append('nvacancies', vagas);
                    formData.append('owner', owner);
                    formData.append('ownerPhone', ownerPhone);
                    formData.append('nbathrooms', banheiros);
                    formData.append('register', registro);


                    for (const file of files) {
                        formData.append('images', file);
                    }

                    const response = await fetch('http://localhost:5502/properties/create', {
                        method: 'POST',
                        body: formData,
                    });

                    if (response.ok) {
                        const responseData = await response.json();
                        console.log(responseData);
                    } else {
                        const errorData = await response.json();
                        console.error('Erro ao enviar dados:', response.status, errorData.message);
                    }
                } catch (error) {
                    console.error('Erro na requisição:', error);
                }
            }
    </script>
    

    <script src="../../javascript/nav.js"></script>
    <script src="../../javascript/upload.js"></script>
</body>
</html>